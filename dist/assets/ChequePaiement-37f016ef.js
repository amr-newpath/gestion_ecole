import{_ as f,k as h,r as _,o as l,c as d,b as e,m as u,p as y,v as w,F as g,f as x,t as i,a as v,g as b}from"./index-8845255c.js";import"./_baseGetTag-2ed90e23.js";const P={data(){return{selectedStatus:"",isLoading:!1,searchQuery:"",paiements:[],parentNames:{}}},computed:{filteredPaiements(){const s=this.searchQuery.trim().toLowerCase();return this.paiements.filter(t=>(t.eleve.nom.toLowerCase().includes(s)||t.eleve.prenom.toLowerCase().includes(s)||this.parentNames[t.eleve.famille_id].toLowerCase().includes(s)||this.getPaiementChequeReference(t).toLowerCase().includes(s))&&t.modes.some(r=>r.type==="Chèque"&&r.paid===0))},calculateTotalMontant(){return this.filteredPaiements.reduce((t,o)=>t+this.calculatePaiementMontant(o),0)+" DHs"}},methods:{async pay(s){try{await h.put(`/comptable/update-payment/${s.id}`,{pending:!1,chequePaid:!0}),await this.fetchPaiements()}catch(t){console.error("Error updating payment:",t)}},navigateToPayer(){this.$router.push({name:"CreatePaiement"})},clearFilters(){this.searchQuery="",this.selectedStatus=""},async fetchPaiements(){try{this.isLoading=!0;const s=await h.get("/comptable/paiements-modes");this.paiements=s.data,this.isLoading=!1}catch(s){console.error("Error fetching paiements:",s),this.isLoading=!1}},getPaiementChequeMontant(s){return s.modes.filter(o=>o.type==="Chèque"&&o.paid===0).reduce((o,r)=>o+r.montant,0)},getPaiementChequeReference(s){const t=s.modes.find(o=>o.type==="Chèque"&&o.paid===0);return t?t.ref:""},calculatePaiementMontant(s){return s.modes.reduce((t,o)=>(o.type==="Chèque"&&o.paid===0&&(t+=o.montant),t),0)},async fetchParentNames(){try{const t=(await h.get("/comptable/parents")).data;this.parentNames=t.reduce((o,r)=>(o[r.id]=r.nom_complet,o),{}),console.log(this.parentNames)}catch(s){console.error("Error fetching parents:",s)}}},watch:{},async mounted(){await Promise.all([this.fetchPaiements(),this.fetchParentNames()])}},C={class:"antialiased bg-gray-100 text-gray-600 my-16 px-4"},q={class:"flex flex-col justify-center h-full"},M={class:"w-full max-w-6xlxl mx-auto bg-white shadow-lg rounded-sm border border-gray-200"},L=e("header",{class:"px-5 py-4 border-b border-gray-100"},[e("h2",{class:"font-semibold text-gray-800"},"Gestion des chèques")],-1),S={class:"p-3"},k={class:"flex items-center justify-between mb-4"},N={class:"flex space-x-4"},Q=e("option",{value:""},"Status",-1),F=e("option",{value:"Payé"},"Payé",-1),T=e("option",{value:"Impayé"},"Impayé",-1),j=[Q,F,T],E={class:"overflow-x-auto"},V={key:0,class:"table-auto w-full"},D=e("thead",{class:"text-xs font-semibold uppercase text-gray-400 bg-gray-50"},[e("tr",null,[e("th",{class:"p-4 whitespace-nowrap"},[e("div",{class:"font-semibold text-left"},"Eleve")]),e("th",{class:"p-4 whitespace-nowrap"},[e("div",{class:"font-semibold text-left"},"Code")]),e("th",{class:"p-4 whitespace-nowrap"},[e("div",{class:"font-semibold text-left"},"Parent")]),e("th",{class:"p-4 whitespace-nowrap"},[e("div",{class:"font-semibold text-left"},"Ref")]),e("th",{class:"p-4 whitespace-nowrap"},[e("div",{class:"font-semibold text-left"},"Montant")]),e("th",{class:"p-4 whitespace-nowrap"},[e("div",{class:"font-semibold text-center"},"Actions")])])],-1),R={class:"text-sm divide-y divide-gray-100"},B={class:"p-4 whitespace-nowrap"},H={class:"font-medium text-gray-800"},I={class:"p-4 whitespace-nowrap"},U={class:"text-left"},z={class:"p-4 whitespace-nowrap"},A={class:"text-left"},G={class:"p-4 whitespace-nowrap"},J={class:"text-left"},K={class:"p-4 whitespace-nowrap"},O={class:"text-left"},W={class:"p-4 whitespace-nowrap"},X={class:"flex flex-col items-center space-y-2"},Y=["onClick"],Z=e("td",{colspan:"4",class:"p-4 whitespace-nowrap font-semibold just text-right text-yellow-500"}," Total Montant: ",-1),$={class:"p-4 whitespace-nowrap font-semibold text-left"},ee=e("td",{class:"p-4 whitespace-nowrap"},null,-1),te={key:1,class:"flex justify-center items-center h-32"},se=e("div",{class:"w-12 h-12 border-t-4 border-blue-500 border-solid rounded-full animate-spin"},null,-1),oe=[se];function ae(s,t,o,r,c,n){const p=_("font-awesome-icon");return l(),d("section",C,[e("div",q,[e("div",M,[L,e("div",S,[e("div",k,[e("div",N,[u(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>c.searchQuery=a),placeholder:"Search",class:"block ww-48 rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"},null,512),[[y,c.searchQuery]]),u(e("select",{"onUpdate:modelValue":t[1]||(t[1]=a=>c.selectedStatus=a),onChange:t[2]||(t[2]=(...a)=>n.filteredPaiements&&n.filteredPaiements(...a)),class:"px-2 py-1 border rounded-md focus:outline-none"},j,544),[[w,c.selectedStatus]])]),e("button",{onClick:t[3]||(t[3]=(...a)=>n.clearFilters&&n.clearFilters(...a)),class:"px-3 py-1 bg-gray-300 rounded-md hover:bg-gray-400 focus:outline-none"}," Clear Filters ")]),e("div",E,[c.isLoading?(l(),d("div",te,oe)):(l(),d("table",V,[D,e("tbody",R,[(l(!0),d(g,null,x(n.filteredPaiements,(a,m)=>(l(),d("tr",{key:m},[e("td",B,[e("div",H,i(a.eleve.nom)+" "+i(a.eleve.prenom),1)]),e("td",I,[e("div",U,i(a.eleve.code),1)]),e("td",z,[e("div",A,i(c.parentNames[a.eleve.famille_id]),1)]),e("td",G,[e("div",J,i(n.getPaiementChequeReference(a)),1)]),e("td",K,[e("div",O,i(n.getPaiementChequeMontant(a))+" DHs ",1)]),e("td",W,[e("div",X,[e("button",{onClick:ne=>n.pay(a),class:"flex items-center justify-center px-4 py-2 rounded-md text-green-500 bg-white hover:bg-green-50 transition duration-300 focus:outline-none focus:ring focus:ring-green-200"},[v(p,{icon:["fas","dollar-sign"],class:"h-5 w-5 mr-1"}),b(" Pay ")],8,Y)])])]))),128)),e("tr",null,[Z,e("td",$,i(n.calculateTotalMontant),1),ee])])]))])])])])])}const ce=f(P,[["render",ae]]);export{ce as default};
