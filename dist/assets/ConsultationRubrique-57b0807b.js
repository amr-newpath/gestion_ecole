import{_ as y,k as p,r as g,o as i,c,b as e,m as d,p as x,v as h,F as f,f as v,t as a,a as b,g as M}from"./index-8845255c.js";import{d as E}from"./debounce-4a8da910.js";import"./_baseGetTag-2ed90e23.js";const C={data(){return{selectedMonth:"Sept",selectedNiveau:"",isLoading:!1,searchQuery:"",eleves:[],months:["Sept","Oct","Nov","Dec","Jan","Feb","Mar","Apr","May","June","July"]}},computed:{filteredEleves(){const o=this.searchQuery.toLowerCase(),t=this.eleves.filter(n=>n.nom.toLowerCase().includes(o)||n.prenom.toLowerCase().includes(o)||n.famille.nom_complet.toLowerCase().includes(o));return!this.selectedMonth&&!this.selectedNiveau?t:t.filter(n=>n.paiements.some(u=>u.status==="Not completed"&&u.services.some(l=>(!this.selectedMonth||l.pivot.month===this.selectedMonth&&l.pivot.paid===0)&&(!this.selectedNiveau||n.niveau===this.selectedNiveau)&&(l.service==="Frais scolarité"||l.service==="Transport"))))},calculateTotalMontant(){return this.filteredEleves.reduce((t,n)=>t+this.calculateServicesMontant(n),0)+" DHs"}},methods:{navigateToPayer(){this.$router.push({name:"CreatePaiement"})},clearFilters(){this.searchQuery=""},async fetchPaiementsForEleve(o){try{return(await p.get(`/comptable/eleves/${o}/paiements`)).data}catch(t){return console.error("Error fetching paiements:",t),[]}},async fetchEleves(){try{this.isLoading=!0;const o=await p.get("/comptable/eleves");this.eleves=o.data;for(const t of this.eleves)t.paiements=await this.fetchPaiementsForEleve(t.id);this.isLoading=!1}catch(o){console.error("Error fetching eleves:",o),this.isLoading=!1}},calculateServicesMontant(o){return o.paiements.reduce((t,n)=>t+this.calculateUnpaidServicesMontant(n.services),0)},calculateUnpaidServicesMontant(o){return o.reduce((t,n)=>((n.service==="Frais scolarité"||n.service==="Transport")&&n.pivot.paid===0&&(!this.selectedMonth||n.pivot.month===this.selectedMonth)&&(t+=n.pivot.price),t),0)}},watch:{selectedMonth:function(o){this.filteredEleves=this.eleves},searchQuery:E(function(o){},300)},mounted(){this.fetchEleves()}},N={class:"antialiased bg-gray-100 text-gray-600 my-16 px-4"},S={class:"flex flex-col justify-center h-full"},F={class:"w-full max-w-6xlxl mx-auto bg-white shadow-lg rounded-sm border border-gray-200"},k=e("header",{class:"px-5 py-4 border-b border-gray-100"},[e("h2",{class:"font-semibold text-gray-800"},"Consultation rubrique")],-1),L={class:"p-3"},T={class:"flex items-center justify-between mb-4"},P={class:"flex space-x-4"},Q=["value"],V=e("option",{value:""},"All Niveau",-1),U=e("option",{value:""},null,-1),j=[V,U],D=e("option",{value:""},"Anneé Scolaire",-1),A=e("option",{value:""},null,-1),B=[D,A],q={class:"overflow-x-auto"},J={key:0,class:"table-auto w-full"},H=e("thead",{class:"text-xs font-semibold uppercase text-gray-400 bg-gray-50"},[e("tr",null,[e("th",{class:"p-4 whitespace-nowrap"},[e("div",{class:"font-semibold text-left"},"Eleve")]),e("th",{class:"p-4 whitespace-nowrap"},[e("div",{class:"font-semibold text-left"},"Code")]),e("th",{class:"p-4 whitespace-nowrap"},[e("div",{class:"font-semibold text-left"},"Parent")]),e("th",{class:"p-4 whitespace-nowrap"},[e("div",{class:"font-semibold text-left"},"Niveau")]),e("th",{class:"p-4 whitespace-nowrap"},[e("div",{class:"font-semibold text-left"},"Montant")]),e("th",{class:"p-4 whitespace-nowrap"},[e("div",{class:"font-semibold text-center"},"Actions")])])],-1),O={class:"text-sm divide-y divide-gray-100"},R={class:"p-4 whitespace-nowrap"},z={class:"font-medium text-gray-800"},G={class:"p-4 whitespace-nowrap"},I={class:"text-left"},K={class:"p-4 whitespace-nowrap"},W={class:"text-left"},X={class:"p-4 whitespace-nowrap"},Y={class:"text-left"},Z={class:"p-4 whitespace-nowrap"},$={class:"text-left"},ee={class:"p-4 whitespace-nowrap"},te={class:"flex flex-col items-center space-y-2"},se=e("td",{colspan:"4",class:"p-4 whitespace-nowrap font-semibold just text-right text-yellow-500"}," Total Montant: ",-1),oe={class:"p-4 whitespace-nowrap font-semibold text-left"},ne=e("td",{class:"p-4 whitespace-nowrap"},null,-1),le={key:1,class:"flex justify-center items-center h-32"},re=e("div",{class:"w-12 h-12 border-t-4 border-blue-500 border-solid rounded-full animate-spin"},null,-1),ae=[re];function ie(o,t,n,u,l,r){const m=g("font-awesome-icon");return i(),c("section",N,[e("div",S,[e("div",F,[k,e("div",L,[e("div",T,[e("div",P,[d(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>l.searchQuery=s),placeholder:"Search",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"},null,512),[[x,l.searchQuery]]),d(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>l.selectedMonth=s),onChange:t[2]||(t[2]=(...s)=>r.filteredEleves&&r.filteredEleves(...s)),class:"px-2 py-1 border rounded-md focus:outline-none"},[(i(!0),c(f,null,v(l.months,s=>(i(),c("option",{key:s,value:s},a(s),9,Q))),128))],544),[[h,l.selectedMonth]]),d(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>l.selectedNiveau=s),onChange:t[4]||(t[4]=(...s)=>r.filteredEleves&&r.filteredEleves(...s)),class:"px-2 py-1 border rounded-md focus:outline-none"},j,544),[[h,l.selectedNiveau]]),d(e("select",{"onUpdate:modelValue":t[5]||(t[5]=s=>l.selectedNiveau=s),onChange:t[6]||(t[6]=(...s)=>r.filteredEleves&&r.filteredEleves(...s)),class:"px-2 py-1 border rounded-md focus:outline-none"},B,544),[[h,l.selectedNiveau]])]),e("button",{onClick:t[7]||(t[7]=(...s)=>r.clearFilters&&r.clearFilters(...s)),class:"px-3 py-1 bg-gray-300 rounded-md hover:bg-gray-400 focus:outline-none"}," Clear Filters ")]),e("div",q,[l.isLoading?(i(),c("div",le,ae)):(i(),c("table",J,[H,e("tbody",O,[(i(!0),c(f,null,v(r.filteredEleves,(s,_)=>(i(),c("tr",{key:_},[e("td",R,[e("div",z,a(s.nom)+" "+a(s.prenom),1)]),e("td",G,[e("div",I,a(s.code),1)]),e("td",K,[e("div",W,a(s.famille.nom_complet),1)]),e("td",X,[e("div",Y,a(s.niveau),1)]),e("td",Z,[e("div",$,a(r.calculateServicesMontant(s))+" DHs ",1)]),e("td",ee,[e("div",te,[e("button",{onClick:t[8]||(t[8]=(...w)=>r.navigateToPayer&&r.navigateToPayer(...w)),class:"flex items-center justify-center px-4 py-2 rounded-md text-green-500 bg-white hover:bg-green-50 transition duration-300 focus:outline-none focus:ring focus:ring-green-200"},[b(m,{icon:["fas","dollar-sign"],class:"h-5 w-5 mr-1"}),M(" Pay ")])])])]))),128)),e("tr",null,[se,e("td",oe,a(r.calculateTotalMontant),1),ne])])]))])])])])])}const he=y(C,[["render",ie]]);export{he as default};
